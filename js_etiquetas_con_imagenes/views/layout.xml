<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="js_etiquetas_con_imagen" inherit_id="product.report_simple_label" name="JIM Etiquetas con imagen">
        <xpath expr="//div" position="replace">
            <div class="col-xs-6" style="padding: 0;">
                <table style="border-spacing: 0; margin-bottom: 1px; height: 100px;" class="table">
                    <thead style="background-color:white;">
                        <tr style="width: 4in;">
                            <td style="border: 1px solid black; width: 2.5in;" colspan="2" class="col-xs-12 danger">
                                <!-- La referencia interna -->
                                <t t-if="product.default_code">                                    
                                    <strong t-field="product.default_code"/><br/>
                                </t>
                                <!-- El nombre -->
                                <strong t-field="product.name"/><br/>
                                <!--
                                Según la nomenclatura de referencias de Jim, primero va el código del color y luego el del tallaje.
                                El array en que se guardan los atributos no tiene por qué respetar esto, probablemente se guarde en el orden de creación,
                                por lo que si primero se añadió el tallaje, aparecerá éste primero en el PDF.
                                Para resolver esto y que se muestren en el orden de Jim (patrón.color.tallaje):
                                - si en el foreach sale primero el tallaje no se imprime, se guarda en una variable.
                                - si sale primero el color se imprime normalmente.
                                - al salir del foreach se imprime la variable: 
                                  - si el color fue primero se imprime vacía
                                  - si el tallaje fue primero se imprime el tallaje.
                                De esta forma se asegura que el tallaje siempre se imprima en último lugar.
                                 -->
                                <t t-set="html_con_los_atributos" t-value="''" /><!-- variable para almacenar el tallaje que se imprimirá fuera del foreach -->
                                <t t-foreach="product.attribute_value_ids" t-as="id_atributo">
                                    <t t-if="id_atributo.attribute_id.name != 'COULEUR'">
                                        <!-- Primero el nombre del atributo y después su valor -->
                                        <!-- Se guarda el tallaje -->
                                        <t t-set="html_con_los_atributos" t-value="id_atributo.attribute_id.name + ': ' + id_atributo.name" />
                                    </t>
                                    <t t-else="">
                                        <span t-field="id_atributo.attribute_id.name"/>: <span t-field="id_atributo.name"/><br/>
                                    </t>
                                </t>
                                <!-- Esta variable o está vacía o tiene el html del tallaje -->
                                <t t-if="html_con_los_atributos != ''">
                                    <span t-esc="html_con_los_atributos" />
                                </t>
                                <t t-else="">
                                   <span>.</span>
                                </t>
                            </td>
                        </tr>
                    </thead>
                    <!--
                    <tbody>
                        <tr style="width: 1in;">
                             <td style="border: 1px solid black; text-align: center; vertical-align: middle;" class="col-xs-12">
                                <t t-if="product.image_variant">
                                    <img t-att-src="'data:image/png;base64,%s' % to_text(product.image_variant)" style="width: 100%; height: 100%; max-height: 50px; max-width: 50px;" />
                                </t>
                                <t t-else="">
                                    <img t-att-src="'data:image/png;base64,%s' % to_text(product.image)" style="width: 100%; height: 100%; max-height: 50px; max-width: 50px;" />
                                </t>
                            </td>
                        </tr>
                    </tbody>
                    -->
                </table>
            </div>
        </xpath>
    </template>
</odoo>
