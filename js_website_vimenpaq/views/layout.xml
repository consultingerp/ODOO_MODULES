<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <!-- ESTILOS Y JAVASCRIPT -->

    <template id="template_includes" inherit_id="website.assets_frontend" name="JIM Template Includes">

        <xpath expr="link[last()]" position="after">
            <!-- CSS DE BOOTSTRAP-SELECT https://developer.snapappointments.com/bootstrap-select/ -->
            <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/css/bootstrap-select.min.css" rel="stylesheet" />
            <link href="/js_website_vimenpaq/static/less/styles.less" rel="stylesheet" type="text/less"/>
        </xpath>

        <xpath expr="script[last()]" position="after">
            <!-- JS DE BOOTSTRAP SELECT https://developer.snapappointments.com/bootstrap-select/ -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/js/bootstrap-select.min.js"></script>
        </xpath>

    </template>

    <!-- SECCIÓN SUCURSALES DE VIMENPAQ -->

    <record id="view_vimenpaq_office_tree" model="ir.ui.view">
        <field name="name">js_website_vimenpaq.office.tree</field>
        <field name="model">js_website_vimenpaq.office</field>
        <field name="arch" type="xml">
            <tree string="Sucursal">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="city"/>
                <field name="phone"/>
            </tree>
        </field>
    </record>

    <record id="view_delivery_carrier_search" model="ir.ui.view">
        <field name="name">js_website_vimenpaq.office.search</field>
        <field name="model">js_website_vimenpaq.office</field>
        <field name="arch" type="xml">
            <search string="Vimenpaq Office">
                <field name="name" string="Office (name)" />
                <field name="city"/>
                <filter string="Archived" name="inactive" domain="[('active','=',False)]"/>
            </search>
        </field>
    </record>

    <record id="view_vimenpaq_office_form" model="ir.ui.view">
        <field name="name">js_website_vimenpaq.office.form</field>
        <field name="model">js_website_vimenpaq.office</field>
        <field name="arch" type="xml">
            <form string="Sucursal">
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                            <field name="active" widget="boolean_button" options='{"terminology": "active"}'/>
                        </button>
                    </div>
                    <div class="oe_title" name="title">
                        <label for="name" string="Name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" placeholder="Santo Domingo - Oficina principal"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <label for="phone"/>
                            <div>
                                <field name="phone" placeholder="(809) 475-3870"/>
                            </div>
                            <label for="schedule"/>
                            <div>
                                <field name="schedule" placeholder="Lun-Vier. 10:00am - 07:00pm"/>
                            </div>
                        </group>
                        <group>
                            <label for="address"/>
                            <div>
                                <field name="address" placeholder="Ave. John F. Kennedy esq. Máximo Gómez, Nivel Acuario Local AC54"/>
                            </div>
                            <label for="city"/>
                            <div>
                                <field name="city" placeholder="Santo Domingo"/>
                            </div>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="vimenpaq_offices" model="ir.actions.act_window">
        <field name="name">Vimenpaq Offices</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">js_website_vimenpaq.office</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click to define a new Vimenpaq office.
          </p><p>
            Enter all the offices where the customer can pick up the package
          </p>
        </field>
    </record>

    <menuitem id="menu_ecommerce_vimenpaq" parent="website_sale.menu_ecommerce_settings" name="Sucursales Vimenpaq" action="vimenpaq_offices" sequence="10" />

    <!-- CAMBIAR TÍTULO DE DIRECCIÓN EN PROCESO DE CHECKOUT Y SOLO APAREZCA LA REP. DOMINICANA EN PAISES -->

    <template id="vimenpaq_address_management" inherit_id="website_sale.address" name="Vimenpaq Address Management">
        <xpath expr="//div[hasclass('container', 'oe_website_sale')]" position="replace">
            <div class="container oe_website_sale">
                <div class="row">
                    <div class="col-md-8 col-md-offset-2 oe_cart">
                        <div class="row">
                            <t t-call="website_sale.wizard_checkout">
                                <t t-set="step" t-value="20"/>
                            </t>
                        </div>
                        <div class="row">
                            <t t-if="mode == ('new', 'billing')">
                                <h2 class="page-header mt8 ml16">Datos de facturación
                                    <small> o </small>
                                    <a href="/web/login?redirect=/shop/checkout" class="btn btn-primary" style="margin-top: -11px">Iniciar sesión</a>
                                </h2>
                            </t>
                            <t t-if="mode == ('edit', 'billing')">
                                <h2 class="page-header mt8 ml16">Datos de facturación</h2>
                            </t>
                            <t t-if="mode[1] == 'shipping'">
                                <h2 class="page-header mt8 ml16">Dirección de envío </h2>
                            </t>
                            <t t-if="error" t-foreach="error.get('error_message', [])" t-as="err">
                                <h4 class="text-danger" t-esc="err"/>
                            </t>
                            <form name="/shop/checkout" method="post" class="checkout_autoformat">
                                <div t-attf-class="form-group #{error.get('name') and 'has-error' or ''} col-md-12 div_name">
                                    <label class="control-label" for="name">Nombre</label>
                                    <input type="text" name="name" class="form-control" t-att-value="'name' in checkout and checkout['name']"/>
                                </div>
                                <div class="clearfix"/>
                                <t t-if="mode[1] == 'billing'">
                                    <div t-attf-class="form-group #{error.get('email') and 'has-error' or ''} col-md-6" id="div_email">
                                        <label class="control-label" for="email">Email</label>
                                        <input type="email" name="email" class="form-control" t-att-value="'email' in checkout and checkout['email']"/>
                                    </div>
                                </t>
                                <div t-attf-class="form-group #{error.get('phone') and 'has-error' or ''} col-md-6" id="div_phone">
                                    <label class="control-label" for="phone">Teléfono</label>
                                    <input type="tel" name="phone" class="form-control" t-att-value="'phone' in checkout and checkout['phone']"/>
                                </div>
                                <div class="clearfix"/>
                                <t t-if="mode == ('new', 'billing')">
                                    <div t-attf-class="form-group #{error.get('company_name') and 'has-error' or ''} col-md-6">
                                        <label class="control-label font-weight-normal label-optional" for="company_name">Nombre de la compañía</label>
                                        <input type="text" name="company_name" class="form-control" t-att-value="'company_name' in checkout and checkout['company_name']"/>
                                    </div>
                                    <div t-attf-class="form-group #{error.get('vat') and 'has-error' or ''} col-md-6 div_vat">
                                        <label class="control-label font-weight-normal label-optional" for="vat">TIN / IVA </label>
                                        <input type="text" name="vat" class="form-control" t-att-value="'vat' in checkout and checkout['vat']"/>
                                    </div>
                                </t>
                                <div class="clearfix"/>
                                <div t-attf-class="form-group #{error.get('street') and 'has-error' or ''} col-md-12 div_street">
                                    <label class="control-label" for="street">Calle <span class="hidden-xs"> y número</span></label>
                                    <input type="text" name="street" class="form-control" t-att-value="'street' in checkout and checkout['street']"/>
                                </div>
                                <div t-attf-class="form-group #{error.get('street2') and 'has-error' or ''} col-md-12 div_street2">
                                    <label class="control-label label-optional" for="street2">Calle 2</label>
                                    <input type="text" name="street2" class="form-control" t-att-value="'street2' in checkout and checkout['street2']"/>
                                </div>
                                <div class="clearfix"/>
                                <t t-set="zip_city" t-value="country and [x for x in country.get_address_fields() if x in [&quot;zip&quot;, &quot;city&quot;]] or [&quot;city&quot;, &quot;zip&quot;]"/>
                                <t t-if="'zip' in zip_city and zip_city.index('zip') &lt; zip_city.index('city')">
                                    <div t-attf-class="form-group #{error.get('zip') and 'has-error' or ''} col-sm-4 div_zip">
                                        <label class="control-label label-optional" for="zip">Código postal</label>
                                        <input type="text" name="zip" class="form-control" t-att-value="'zip' in checkout and checkout['zip']"/>
                                    </div>
                                </t>
                                <div t-attf-class="form-group #{error.get('city') and 'has-error' or ''} col-sm-8 div_city">
                                    <label class="control-label" for="city">Ciudad</label>
                                    <input type="text" name="city" class="form-control" t-att-value="'city' in checkout and checkout['city']"/>
                                </div>
                                <t t-if="'zip' in zip_city and zip_city.index('zip') &gt; zip_city.index('city')">
                                    <div t-attf-class="form-group #{error.get('zip') and 'has-error' or ''} col-sm-4 div_zip">
                                        <label class="control-label label-optional" for="zip">Código postal</label>
                                        <input type="text" name="zip" class="form-control" t-att-value="'zip' in checkout and checkout['zip']"/>
                                    </div>
                                </t>
                                <div class="clearfix"/>
                                <div t-attf-class="form-group #{error.get('country_id') and 'has-error' or ''} col-md-6 div_country">
                                    <label class="control-label" for="country_id">País</label>
                                    <select id="country_id" name="country_id" class="form-control disabled">
                                        <option value="61" selected="True">República Dominicana</option>
                                    </select>
                                </div>
                                <div t-attf-class="form-group #{error.get('state_id') and 'has-error' or ''} col-md-6 div_state" t-att-style="(not country or not country.state_ids) and 'display: none'">
                                    <label class="control-label" for="state_id">Provincia</label>
                                    <select name="state_id" class="form-control" data-init="1">
                                        <option value="">Estado / Provincia...</option>
                                        <t t-foreach="country and country.state_ids or []" t-as="s">
                                            <option t-att-value="s.id" t-att-selected="s.id == ('state_id' in checkout and country and checkout['state_id'] != '' and int(checkout['state_id']))">
                                                <t t-esc="s.name"/>
                                            </option>
                                        </t>
                                    </select>
                                </div>

                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <input type="hidden" name="submitted" value="1"/>
                                <input type="hidden" name="partner_id" t-att-value="partner_id or '0'"/>
                                <input type="hidden" name="callback" t-att-value="callback"/>
                                <!-- Example -->
                                <input type="hidden" name="field_required" t-att-value="'phone,name'"/>

                                <div class="clearfix"/>
                                <div style="padding: 0 15px">
                                    <a t-att-href="mode == ('new', 'billing') and '/shop/cart' or '/shop/checkout'" class="btn btn-default mb32">
                                        <span class="fa fa-long-arrow-left"/> Atrás
                                    </a>
                                    <a class="btn btn-primary pull-right mb32 a-submit a-submit-disable a-submit-loading">
                                        <span>Siguiente </span><span class="fa fa-long-arrow-right"/>
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
    </template>

    <!-- SELECCIÓN DE SUCURSAL DE VIMENPAQ EN CHECKOUT -->

    <template id="office_selection" inherit_id="website_sale.checkout" name="Vimenpaq Office Selection">
        <!-- INCORPORAR FORMULARIO DEBAJO DE DIRECCIÓN DE FACTURACIÓN -->
        <xpath expr="//div[hasclass('oe_cart')]/div[2]" position="after">
            <t t-if="only_services" groups="sale.group_delivery_invoice_address">
                <div class="row">
                    <div class="col-sm-12">
                        <h2 class="page-header mt8">Sucursal Vimenpaq</h2>
                    </div>
                    <div class="col-sm-12">
                        <p>Su pedido será enviado a la sucursal seleccionada una vez confirmado el pago del mismo.</p>
                        <form id="vimenpaq_sel_office" action="/shop/vimenpaq" method="post" class="form-horizontal">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                            <div class="form-group">
                                <label class="col-md-2 control-label">Destino</label>
                                <div class="col-md-8">
                                    <select name="office" class="selectpicker" required="true" data-dropup-auto="false" data-show-subtext="true" data-live-search="true">
                                        <option class="hidden"></option>
                                        <t t-foreach="offices" t-as="o">
                                            <option t-att-data-subtext="o.address" t-att-value='o.id' t-att-selected="o.id == selected_office_id">
                                                <t t-esc="o.name"/>
                                            </option>
                                        </t>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button type="submit" class="btn btn-primary">Confirmar <span class="fa fa-long-arrow-right"/></button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </t>
        </xpath>

        <!-- OCULTAR BOTÓN DE CONTINUAR (SE TIENE QUE HACER DESDE EL FORMULARIO) -->
        <xpath expr="//a[hasclass('btn','btn-primary','pull-right')]" position="replace">
            <t t-if="not only_services" groups="sale.group_delivery_invoice_address">
                <a class="btn btn-primary pull-right mb32 " href="/shop/confirm_order">Confirmar <span class="fa fa-long-arrow-right"/></a>
            </t>
        </xpath>
    </template>

    <!-- PÁGINA DE CONFIRMACIÓN DE PEDIDO (CAMBIAR BOTÓN DE PAGO) -->

    <template id="vimenpaq_payment" inherit_id="payment.payment_tokens_list" name="Vimenpaq Payment">
        <xpath expr="//button[@id='o_payment_form_pay']" position="replace">
            <button id="o_payment_form_pay" type="submit" class="btn btn-primary btn-lg mb8 mt8"><i class="fa fa-file"></i> Finalizar</button>
        </xpath>
    </template>

    <!-- INFORMACIÓN DE RECOGIDA EN PÁGINA DE CONFIRMACIÓN -->

    <template id="vimenpaq_bill_to" inherit_id="website_sale.bill_to" name="Vimenpaq Bill To">
        <xpath expr="." position="replace">
            <t name="Bill to" t-name="website_sale.bill_to">
                <div class="panel panel-success break-word">
                    <div class="panel-heading">Datos de facturación:</div>
                    <div class="panel-body">
                        <div class="o_div_text_overflow" t-field="order.partner_invoice_id" t-options="{'widget': 'contact','fields': ['address', 'name', 'phone', 'email']}"/>
                    </div>
                </div>
                <t t-if="not order.only_services">
                    <div class="panel panel-warning break-word">
                        <div class="panel-heading">Dirección de envío:</div>
                        <div class="panel-body">
                            <div class="o_div_text_overflow" t-field="order.partner_shipping_id" t-options="{'widget': 'contact','fields': ['address', 'phone']}"/>
                        </div>
                    </div>
                </t>
            </t>
        </xpath>
    </template>

</odoo>
